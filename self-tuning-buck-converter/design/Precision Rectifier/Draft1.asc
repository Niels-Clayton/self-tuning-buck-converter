Version 4
SHEET 1 1220 680
WIRE -1056 -144 -1200 -144
WIRE -32 -144 -176 -144
WIRE 32 -144 -32 -144
WIRE 48 -144 32 -144
WIRE 208 -144 128 -144
WIRE 240 -144 208 -144
WIRE 368 -144 320 -144
WIRE -1280 -128 -1280 -160
WIRE -880 -112 -880 -144
WIRE -256 -96 -256 -144
WIRE 576 -96 432 -96
WIRE -32 -80 -32 -144
WIRE 32 -80 32 -144
WIRE -1200 -64 -1200 -144
WIRE -1184 -64 -1200 -64
WIRE -1056 -48 -1056 -144
WIRE -1056 -48 -1120 -48
WIRE -1024 -48 -1056 -48
WIRE -1280 -32 -1280 -48
WIRE -1184 -32 -1280 -32
WIRE -1280 -16 -1280 -32
WIRE 432 -16 432 -96
WIRE 448 -16 432 -16
WIRE -1152 0 -1152 -16
WIRE 208 0 208 -144
WIRE 240 0 208 0
WIRE 576 0 576 -96
WIRE 576 0 512 0
WIRE 624 0 576 0
WIRE 752 0 704 0
WIRE 800 0 752 0
WIRE -1408 16 -1408 0
WIRE -176 16 -176 -144
WIRE -128 16 -176 16
WIRE 368 16 368 -144
WIRE 368 16 304 16
WIRE 448 16 368 16
WIRE -32 32 -32 -16
WIRE -32 32 -64 32
WIRE 32 32 32 -16
WIRE 32 32 -32 32
WIRE 128 32 32 32
WIRE 224 32 192 32
WIRE 240 32 224 32
WIRE -256 48 -256 -16
WIRE -256 48 -288 48
WIRE -128 48 -256 48
WIRE 480 48 480 32
WIRE 752 48 752 0
WIRE 272 64 272 48
WIRE -1280 80 -1280 64
WIRE -96 80 -96 64
WIRE 224 80 224 32
WIRE -880 128 -880 96
WIRE 752 128 752 112
WIRE 224 192 224 160
FLAG -1408 16 0
FLAG -1408 -80 VCC
FLAG -880 128 0
FLAG -880 16 ripple
FLAG -1280 -160 VCC
FLAG -1280 80 0
FLAG -1024 -48 V_ref
FLAG -96 0 VCC
FLAG 272 -16 VCC
FLAG -96 80 0
FLAG 272 64 0
FLAG -256 -144 V_ref
FLAG -352 48 ripple
FLAG 224 192 V_ref
FLAG -1152 -80 VCC
FLAG -1152 0 0
FLAG 480 -32 VCC
FLAG 480 48 0
FLAG 752 128 0
FLAG -880 -112 0
FLAG -880 -224 ripple_1
FLAG 800 0 V_sense
SYMBOL voltage -1408 -96 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value 12
SYMBOL voltage -880 0 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value SINE(0 0.4 5k 0 0 0)
SYMBOL res -1296 -144 R0
SYMATTR InstName R4
SYMATTR Value 10k
SYMBOL res -1296 -32 R0
SYMATTR InstName R5
SYMATTR Value 10k
SYMBOL diode 128 48 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D2
SYMATTR Value 1N4148
SYMBOL diode 16 -80 R0
WINDOW 3 35 67 Left 2
SYMATTR InstName D3
SYMATTR Value 1N4148
SYMBOL res 144 -160 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value 1k
SYMBOL res 336 -160 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 1k
SYMBOL cap -288 32 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C1
SYMATTR Value 10µ
SYMBOL res -272 -112 R0
SYMATTR InstName R3
SYMATTR Value 1Meg
SYMBOL cap -48 -80 R0
SYMATTR InstName C2
SYMATTR Value 47p
SYMBOL res 208 64 R0
SYMATTR InstName R6
SYMATTR Value 1k
SYMBOL Opamps\\OP27 -1152 -112 R0
SYMATTR InstName U4
SYMBOL Opamps\\OP27 -96 -32 R0
SYMATTR InstName U1
SYMBOL Opamps\\OP27 272 -48 R0
SYMATTR InstName U2
SYMBOL Opamps\\OP27 480 -64 R0
SYMATTR InstName U3
SYMBOL res 720 -16 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R7
SYMATTR Value 1k
SYMBOL cap 736 48 R0
SYMATTR InstName C4
SYMATTR Value 15.9µ
SYMBOL voltage -880 -240 R0
WINDOW 3 37 97 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V3
SYMATTR Value PULSE(-0.4 0.4 0 0.02m 0.08m 1e-10 0.1m)
TEXT 590 -248 Left 2 !.tran 0 0.1004s 0.1002s 0.02
